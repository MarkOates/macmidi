properties:
  - name: initialized
    type: bool
    init_with: false
  - name: midi_client_ref
    type: MIDIClientRef
    init_with: 0
functions:
  - name: initialize
    type: void
    body: |
      if (initialized) return;
      MIDIClientCreate(CFSTR("MIDI Echo"), NULL, NULL, &midi_client_ref);
      initialized = true;
  - name: get_num_devices
    type: int
    body: return MIDIGetNumberOfDevices();
  - name: enumerate_devices
    type: void
    body: |
      CFStringRef pname, pmanuf, pmodel;
      char name[64], manuf[64], model[64];
      int i = 0;
      for (i = 0; i < get_num_devices(); ++i)
      {
        MIDIDeviceRef dev = MIDIGetDevice(i);

        MIDIObjectGetStringProperty(dev, kMIDIPropertyName, &pname);
        MIDIObjectGetStringProperty(dev, kMIDIPropertyManufacturer, &pmanuf);
        MIDIObjectGetStringProperty(dev, kMIDIPropertyModel, &pmodel);

        CFStringGetCString(pname, name, sizeof(name), 0);
        CFStringGetCString(pmanuf, manuf, sizeof(manuf), 0);
        CFStringGetCString(pmodel, model, sizeof(model), 0);
        CFRelease(pname);
        CFRelease(pmanuf);
        CFRelease(pmodel);

        printf("name=%s, manuf=%s, model=%s\n", name, manuf, model);
      }
function_body_symbol_dependencies:
  - MIDIPacketList*
  - MIDIClientRef
  - MIDIClientCreate
  - MIDIGetNumberOfDevices
  - std::runtime_error
  - MIDIGetDevice
  - MIDIObjectGetStringProperty
  - kMIDIPropertyName
  - kMIDIPropertyManufacturer
  - kMIDIPropertyModel
dependencies:
  - symbol: MIDIPacketList*
    headers: [ 'CoreMIDI/MIDIServices.h' ]
  - symbol: MIDIClientRef
    headers: [ 'CoreMIDI/MIDIServices.h' ]
  - symbol: MIDIClientCreate
    headers: [ 'CoreMIDI/MIDIServices.h' ]
  - symbol: MIDIGetNumberOfDevices
    headers: [ 'CoreMIDI/MIDIServices.h' ]
  - symbol: MIDIGetDevice
    headers: [ 'CoreMIDI/MIDIServices.h' ]
  - symbol: std::runtime_error
    headers: [ 'stdexcept' ]
  - symbol: MIDIObjectGetStringProperty
    headers: [ 'CoreMIDI/MIDIServices.h' ]
  - symbol: kMIDIPropertyName
    headers: [ 'CoreMIDI/MIDIServices.h' ]
  - symbol: kMIDIPropertyManufacturer
    headers: [ 'CoreMIDI/MIDIServices.h' ]
  - symbol: kMIDIPropertyModel
    headers: [ 'CoreMIDI/MIDIServices.h' ]
  - symbol: CFStringGetCString
